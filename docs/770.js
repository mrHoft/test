"use strict";(self.webpackChunknonograms=self.webpackChunknonograms||[]).push([[770],{4770:(e,t,s)=>{s.r(t),s.d(t,{Sound:()=>a});const i={dot:{url:"./public/dot.ogg",type:"multiple"},tod:{url:"./public/tod.ogg",type:"multiple"},cross:{url:"./public/cross.ogg",type:"multiple"},whoosh:{url:"./public/whoosh01.ogg"},slide:{url:"./public/whoosh02.ogg"},step:{url:"./public/step.ogg",type:"multiple"}},n=[{name:"Intro",url:"./public/track01.ogg"},{name:"Tool In Space",url:"./public/track02.ogg"},{name:"Inside The Bucket",url:"./public/track03.ogg"}],l={win:["./public/win01.ogg"],loose:["./public/loose01.ogg","./public/loose02.ogg","./public/loose03.ogg","./public/loose04.ogg","./public/loose05.ogg"]},o=Object.keys(i).length+2*n.length+Object.values(l).reduce(((e,t)=>e+t.length),0);class a{static _instance;sound={volume:.5,muted:!1};music={volume:.25,muted:!0};sounds={};tracks=[];speech={win:[],loose:[]};_loaded=0;ready=0;_pending=null;_playing=null;readyCallback=()=>{};startPlayCallback=()=>{};exceptionCallback=()=>{};constructor(){if(a._instance)return a._instance;a._instance=this,Object.keys(l).forEach((e=>l[e].forEach((t=>this._getSound(t,e,"speech"))))),Object.keys(i).forEach((e=>this._getSound(i[e].url,e,i[e].type))),n.forEach((e=>this._getSound(e.url,e.name,"music"))),this._canplay=this._canplay.bind(this),this._ended=this._ended.bind(this)}set musicVolume(e){this.music.volume=e,this._playing&&(this._playing.audio.volume=e)}set musicMuted(e){this.music.muted=e,this._playing?this._playing.audio.muted=e:this.play(0,1)}play(e,t){if(this.music.muted)return;if(!this.tracks[e]||!this.tracks[e].ready)return console.log(`Pending music: ${e}. ${this.tracks[e]?this.tracks[e].name:""}`),void(this._pending=e);const s=this.tracks[e].audio;s.volume=this.music.volume,s.muted=this.music.muted,s.play().then((()=>{t&&s.addEventListener("ended",this._ended),this._playing={track:e,audio:s},this.startPlayCallback(this.tracks[e].name)})).catch((e=>{console.warn(e),this.music.muted=!0,this.exceptionCallback()}))}use(e){if(!this.sound.muted)if(this.sounds[e])for(let t=0;t<10;t+=1){const s=this.sounds[e][t];if(0===s.currentTime||s.ended)return s.volume=this.sound.volume,void s.play().catch((e=>console.log(e)))}else console.warn(`No sound: ${e}`)}say(e){if(this.sound.muted)return;if(!this.speech[e])return void console.warn(`No speech: ${e}`);const t=this.speech[e][~~(Math.random()*this.speech[e].length)];t.volume=this.sound.volume,t.play().catch((e=>console.log(e)))}_getSound(e,t,s=0){const i=this,n=new Request(e,{method:"GET",headers:{"Accept-Ranges":"1000000000"},referrerPolicy:"no-referrer"});fetch(n).then((e=>e)).then((async function(e){const n=await e.blob(),l=window.URL.createObjectURL(n);if(i._loaded+=1,i.ready=~~(i._loaded/o*100),"speech"===s){const e=new Audio;e.src=l,i.speech[t].push(e)}else if("music"===s){const e=new Audio;e.src=l,e.localInfo={name:t,track:i.tracks.length},e.addEventListener("canplay",i._canplay),i.tracks.push({audio:e,name:t})}else i.sounds[t]=Array.from({length:"multiple"===s?10:1},(()=>{const e=new Audio;return e.src=l,e}));i.readyCallback(i.ready,t)}))}_canplay(e){e.target.removeEventListener("canplay",this._canplay);const{name:t,track:s}=e.target.localInfo;this._loaded+=1,this.ready=~~(this._loaded/o*100),this.tracks[s].ready=!0,this._pending===s&&(this.play(this._pending,1),this._pending=null),this.readyCallback(this.ready,t)}_ended(){if(!this._playing)return;let e=(this._playing.track??0)+1;e>=this.tracks.length&&(e=0),this._playing=null,this.play(e,1)}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzcwLmpzIiwibWFwcGluZ3MiOiJpSUFBQSxNQUFNQSxFQUFTLENBQ2JDLElBQUssQ0FBRUMsSUFBSyxtQkFBb0JDLEtBQU0sWUFDdENDLElBQUssQ0FBRUYsSUFBSyxtQkFBb0JDLEtBQU0sWUFDdENFLE1BQU8sQ0FBRUgsSUFBSyxxQkFBc0JDLEtBQU0sWUFDMUNHLE9BQVEsQ0FBRUosSUFBSyx5QkFDZkssTUFBTyxDQUFFTCxJQUFLLHlCQUNkTSxLQUFNLENBQUVOLElBQUssb0JBQXFCQyxLQUFNLGFBR3BDTSxFQUFRLENBQ1osQ0FDRUMsS0FBTSxRQUNOUixJQUFLLHdCQUVQLENBQ0VRLEtBQU0sZ0JBQ05SLElBQUssd0JBRVAsQ0FDRVEsS0FBTSxvQkFDTlIsSUFBSyx5QkFJSFMsRUFBUyxDQUNiQyxJQUFLLENBQUMsc0JBQ05DLE1BQU8sQ0FBQyx1QkFBd0IsdUJBQXdCLHVCQUF3Qix1QkFBd0IseUJBR3BHQyxFQUFhQyxPQUFPQyxLQUFLaEIsR0FBUWlCLE9BQXdCLEVBQWZSLEVBQU1RLE9BQWFGLE9BQU9HLE9BQU9QLEdBQVFRLFFBQU8sQ0FBQ0MsRUFBS0MsSUFBU0QsRUFBTUMsRUFBS0osUUFBUSxHQUUzSCxNQUFNSyxFQUNYQyxpQkFDQUMsTUFBUSxDQUFFQyxPQUFRLEdBQUtDLE9BQU8sR0FDOUJqQixNQUFRLENBQUVnQixPQUFRLElBQU1DLE9BQU8sR0FDL0IxQixPQUFTLENBQUMsRUFDVjJCLE9BQVMsR0FDVGhCLE9BQVMsQ0FBRUMsSUFBSyxHQUFJQyxNQUFPLElBQzNCZSxRQUFVLEVBQ1ZDLE1BQVEsRUFDUkMsU0FBVyxLQUNYQyxTQUFXLEtBQ1hDLGNBQWdCLE9BQ2hCQyxrQkFBb0IsT0FDcEJDLGtCQUFvQixPQUVwQixXQUFBQyxHQUNFLEdBQUliLEVBQU1jLFVBQVcsT0FBT2QsRUFBTWMsVUFDbENkLEVBQU1jLFVBQVlDLEtBQ2xCdEIsT0FBT0MsS0FBS0wsR0FBUTJCLFNBQVE1QixHQUFRQyxFQUFPRCxHQUFNNEIsU0FBUXBDLEdBQU9tQyxLQUFLRSxVQUFVckMsRUFBS1EsRUFBTSxjQUMxRkssT0FBT0MsS0FBS2hCLEdBQVFzQyxTQUFRNUIsR0FBUTJCLEtBQUtFLFVBQVV2QyxFQUFPVSxHQUFNUixJQUFLUSxFQUFNVixFQUFPVSxHQUFNUCxRQUN4Rk0sRUFBTTZCLFNBQVFqQixHQUFRZ0IsS0FBS0UsVUFBVWxCLEVBQUtuQixJQUFLbUIsRUFBS1gsS0FBTSxXQUUxRDJCLEtBQUtHLFNBQVdILEtBQUtHLFNBQVNDLEtBQUtKLE1BQ25DQSxLQUFLSyxPQUFTTCxLQUFLSyxPQUFPRCxLQUFLSixLQUNqQyxDQUtBLGVBQUlNLENBQVlDLEdBQ2RQLEtBQUs1QixNQUFNZ0IsT0FBU21CLEVBQ2hCUCxLQUFLTixXQUFVTSxLQUFLTixTQUFTYyxNQUFNcEIsT0FBU21CLEVBQ2xELENBS0EsY0FBSUUsQ0FBV0YsR0FDYlAsS0FBSzVCLE1BQU1pQixNQUFRa0IsRUFDZlAsS0FBS04sU0FBVU0sS0FBS04sU0FBU2MsTUFBTW5CLE1BQVFrQixFQUMxQ1AsS0FBS1UsS0FBSyxFQUFHLEVBQ3BCLENBRUEsSUFBQUEsQ0FBS0MsRUFBT0MsR0FDVixHQUFJWixLQUFLNUIsTUFBTWlCLE1BQU8sT0FFdEIsSUFBS1csS0FBS1YsT0FBT3FCLEtBQVdYLEtBQUtWLE9BQU9xQixHQUFPbkIsTUFHN0MsT0FGQXFCLFFBQVFDLElBQUksa0JBQWtCSCxNQUFVWCxLQUFLVixPQUFPcUIsR0FBU1gsS0FBS1YsT0FBT3FCLEdBQU90QyxLQUFPLFdBQ3ZGMkIsS0FBS1AsU0FBV2tCLEdBSWxCLE1BQU1ILEVBQVFSLEtBQUtWLE9BQU9xQixHQUFPSCxNQUNqQ0EsRUFBTXBCLE9BQVNZLEtBQUs1QixNQUFNZ0IsT0FDMUJvQixFQUFNbkIsTUFBUVcsS0FBSzVCLE1BQU1pQixNQUN6Qm1CLEVBQ0dFLE9BQ0FLLE1BQUssS0FDQUgsR0FBTUosRUFBTVEsaUJBQWlCLFFBQVNoQixLQUFLSyxRQUMvQ0wsS0FBS04sU0FBVyxDQUFFaUIsUUFBT0gsU0FDekJSLEtBQUtKLGtCQUFrQkksS0FBS1YsT0FBT3FCLEdBQU90QyxLQUFJLElBRS9DNEMsT0FBTUMsSUFDTEwsUUFBUU0sS0FBS0QsR0FDYmxCLEtBQUs1QixNQUFNaUIsT0FBUSxFQUNuQlcsS0FBS0gsbUJBQWtCLEdBRTdCLENBRUEsR0FBQXVCLENBQUkvQyxHQUNGLElBQUkyQixLQUFLYixNQUFNRSxNQUNmLEdBQUtXLEtBQUtyQyxPQUFPVSxHQUlqQixJQUFLLElBQUlnRCxFQUFJLEVBQUdBLEVBQUksR0FBSUEsR0FBSyxFQUFHLENBQzlCLE1BQU1iLEVBQVFSLEtBQUtyQyxPQUFPVSxHQUFNZ0QsR0FDaEMsR0FBMEIsSUFBdEJiLEVBQU1jLGFBQXFCZCxFQUFNZSxNQUduQyxPQUZBZixFQUFNcEIsT0FBU1ksS0FBS2IsTUFBTUMsWUFDMUJvQixFQUFNRSxPQUFPTyxPQUFNQyxHQUFTTCxRQUFRQyxJQUFJSSxJQUc1QyxNQVZFTCxRQUFRTSxLQUFLLGFBQWE5QyxJQVc5QixDQUVBLEdBQUFtRCxDQUFJbkQsR0FDRixHQUFJMkIsS0FBS2IsTUFBTUUsTUFBTyxPQUN0QixJQUFLVyxLQUFLMUIsT0FBT0QsR0FFZixZQURBd0MsUUFBUU0sS0FBSyxjQUFjOUMsS0FHN0IsTUFBTW1DLEVBQVFSLEtBQUsxQixPQUFPRCxNQUFTb0QsS0FBS0MsU0FBVzFCLEtBQUsxQixPQUFPRCxHQUFNTyxTQUNyRTRCLEVBQU1wQixPQUFTWSxLQUFLYixNQUFNQyxPQUMxQm9CLEVBQU1FLE9BQU9PLE9BQU1DLEdBQVNMLFFBQVFDLElBQUlJLElBQzFDLENBRUEsU0FBQWhCLENBQVV5QixFQUFNdEQsRUFBTVAsRUFBTyxHQUMzQixNQUFNOEQsRUFBTzVCLEtBQ1A2QixFQUFhLElBQUlDLFFBQVFILEVBQU0sQ0FDbkNJLE9BQVEsTUFDUkMsUUFBUyxDQUNQLGdCQUFpQixjQUVuQkMsZUFBZ0IsZ0JBR2xCQyxNQUFNTCxHQUNIZCxNQUFLb0IsR0FBWUEsSUFDakJwQixNQUFLcUIsZUFBZ0JDLEdBQ3BCLE1BQU1DLFFBQWFELEVBQVFDLE9BQ3JCekUsRUFBTTBFLE9BQU9DLElBQUlDLGdCQUFnQkgsR0FLdkMsR0FIQVYsRUFBS3JDLFNBQVcsRUFDaEJxQyxFQUFLcEMsU0FBWW9DLEVBQUtyQyxRQUFVZCxFQUFjLEtBRWpDLFdBQVRYLEVBQW1CLENBQ3JCLE1BQU0wQyxFQUFRLElBQUlrQyxNQUNsQmxDLEVBQU1tQyxJQUFNOUUsRUFDWitELEVBQUt0RCxPQUFPRCxHQUFNdUUsS0FBS3BDLEVBQ3pCLE1BQU8sR0FBYSxVQUFUMUMsRUFBa0IsQ0FDM0IsTUFBTTBDLEVBQVEsSUFBSWtDLE1BQ2xCbEMsRUFBTW1DLElBQU05RSxFQUNaMkMsRUFBTXFDLFVBQVksQ0FBRXhFLE9BQU1zQyxNQUFPaUIsRUFBS3RDLE9BQU9WLFFBQzdDNEIsRUFBTVEsaUJBQWlCLFVBQVdZLEVBQUt6QixVQUN2Q3lCLEVBQUt0QyxPQUFPc0QsS0FBSyxDQUFFcEMsUUFBT25DLFFBQzVCLE1BQ0V1RCxFQUFLakUsT0FBT1UsR0FBUXlFLE1BQU1DLEtBQUssQ0FBRW5FLE9BQWlCLGFBQVRkLEVBQXNCLEdBQUssSUFBSyxLQUN2RSxNQUFNMEMsRUFBUSxJQUFJa0MsTUFFbEIsT0FEQWxDLEVBQU1tQyxJQUFNOUUsRUFDTDJDLEtBSVhvQixFQUFLakMsY0FBY2lDLEVBQUtwQyxNQUFPbkIsRUFDakMsR0FDSixDQUVBLFFBQUE4QixDQUFTNkMsR0FDUEEsRUFBTUMsT0FBT0Msb0JBQW9CLFVBQVdsRCxLQUFLRyxVQUNqRCxNQUFNLEtBQUU5QixFQUFJLE1BQUVzQyxHQUFVcUMsRUFBTUMsT0FBT0osVUFDckM3QyxLQUFLVCxTQUFXLEVBQ2hCUyxLQUFLUixTQUFZUSxLQUFLVCxRQUFVZCxFQUFjLEtBQzlDdUIsS0FBS1YsT0FBT3FCLEdBQU9uQixPQUFRLEVBR3ZCUSxLQUFLUCxXQUFha0IsSUFDcEJYLEtBQUtVLEtBQUtWLEtBQUtQLFNBQVUsR0FDekJPLEtBQUtQLFNBQVcsTUFFbEJPLEtBQUtMLGNBQWNLLEtBQUtSLE1BQU9uQixFQUNqQyxDQUVBLE1BQUFnQyxHQUNFLElBQUtMLEtBQUtOLFNBQVUsT0FDcEIsSUFBSXlELEdBQVFuRCxLQUFLTixTQUFTaUIsT0FBUyxHQUFLLEVBQ3BDd0MsR0FBUW5ELEtBQUtWLE9BQU9WLFNBQVF1RSxFQUFPLEdBQ3ZDbkQsS0FBS04sU0FBVyxLQUNoQk0sS0FBS1UsS0FBS3lDLEVBQU0sRUFDbEIsRSIsInNvdXJjZXMiOlsid2VicGFjazovL25vbm9ncmFtcy8uL3NyYy91dGlscy9zb3VuZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBzb3VuZHMgPSB7XG4gIGRvdDogeyB1cmw6ICcuL3B1YmxpYy9kb3Qub2dnJywgdHlwZTogJ211bHRpcGxlJyB9LFxuICB0b2Q6IHsgdXJsOiAnLi9wdWJsaWMvdG9kLm9nZycsIHR5cGU6ICdtdWx0aXBsZScgfSxcbiAgY3Jvc3M6IHsgdXJsOiAnLi9wdWJsaWMvY3Jvc3Mub2dnJywgdHlwZTogJ211bHRpcGxlJyB9LFxuICB3aG9vc2g6IHsgdXJsOiAnLi9wdWJsaWMvd2hvb3NoMDEub2dnJyB9LFxuICBzbGlkZTogeyB1cmw6ICcuL3B1YmxpYy93aG9vc2gwMi5vZ2cnIH0sXG4gIHN0ZXA6IHsgdXJsOiAnLi9wdWJsaWMvc3RlcC5vZ2cnLCB0eXBlOiAnbXVsdGlwbGUnIH0sXG59XG5cbmNvbnN0IG11c2ljID0gW1xuICB7XG4gICAgbmFtZTogJ0ludHJvJyxcbiAgICB1cmw6ICcuL3B1YmxpYy90cmFjazAxLm9nZycsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiAnVG9vbCBJbiBTcGFjZScsXG4gICAgdXJsOiAnLi9wdWJsaWMvdHJhY2swMi5vZ2cnLFxuICB9LFxuICB7XG4gICAgbmFtZTogJ0luc2lkZSBUaGUgQnVja2V0JyxcbiAgICB1cmw6ICcuL3B1YmxpYy90cmFjazAzLm9nZycsXG4gIH0sXG5dXG5cbmNvbnN0IHNwZWVjaCA9IHtcbiAgd2luOiBbJy4vcHVibGljL3dpbjAxLm9nZyddLFxuICBsb29zZTogWycuL3B1YmxpYy9sb29zZTAxLm9nZycsICcuL3B1YmxpYy9sb29zZTAyLm9nZycsICcuL3B1YmxpYy9sb29zZTAzLm9nZycsICcuL3B1YmxpYy9sb29zZTA0Lm9nZycsICcuL3B1YmxpYy9sb29zZTA1Lm9nZyddLFxufVxuXG5jb25zdCBjb3VudFRvdGFsID0gT2JqZWN0LmtleXMoc291bmRzKS5sZW5ndGggKyBtdXNpYy5sZW5ndGggKiAyICsgT2JqZWN0LnZhbHVlcyhzcGVlY2gpLnJlZHVjZSgoYWNjLCBpdGVtKSA9PiBhY2MgKyBpdGVtLmxlbmd0aCwgMClcblxuZXhwb3J0IGNsYXNzIFNvdW5kIHtcbiAgc3RhdGljIF9pbnN0YW5jZVxuICBzb3VuZCA9IHsgdm9sdW1lOiAwLjUsIG11dGVkOiBmYWxzZSB9XG4gIG11c2ljID0geyB2b2x1bWU6IDAuMjUsIG11dGVkOiB0cnVlIH1cbiAgc291bmRzID0ge31cbiAgdHJhY2tzID0gW11cbiAgc3BlZWNoID0geyB3aW46IFtdLCBsb29zZTogW10gfVxuICBfbG9hZGVkID0gMFxuICByZWFkeSA9IDBcbiAgX3BlbmRpbmcgPSBudWxsXG4gIF9wbGF5aW5nID0gbnVsbFxuICByZWFkeUNhbGxiYWNrID0gKCkgPT4ge31cbiAgc3RhcnRQbGF5Q2FsbGJhY2sgPSAoKSA9PiB7fVxuICBleGNlcHRpb25DYWxsYmFjayA9ICgpID0+IHt9XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgaWYgKFNvdW5kLl9pbnN0YW5jZSkgcmV0dXJuIFNvdW5kLl9pbnN0YW5jZVxuICAgIFNvdW5kLl9pbnN0YW5jZSA9IHRoaXNcbiAgICBPYmplY3Qua2V5cyhzcGVlY2gpLmZvckVhY2gobmFtZSA9PiBzcGVlY2hbbmFtZV0uZm9yRWFjaCh1cmwgPT4gdGhpcy5fZ2V0U291bmQodXJsLCBuYW1lLCAnc3BlZWNoJykpKVxuICAgIE9iamVjdC5rZXlzKHNvdW5kcykuZm9yRWFjaChuYW1lID0+IHRoaXMuX2dldFNvdW5kKHNvdW5kc1tuYW1lXS51cmwsIG5hbWUsIHNvdW5kc1tuYW1lXS50eXBlKSlcbiAgICBtdXNpYy5mb3JFYWNoKGl0ZW0gPT4gdGhpcy5fZ2V0U291bmQoaXRlbS51cmwsIGl0ZW0ubmFtZSwgJ211c2ljJykpXG5cbiAgICB0aGlzLl9jYW5wbGF5ID0gdGhpcy5fY2FucGxheS5iaW5kKHRoaXMpXG4gICAgdGhpcy5fZW5kZWQgPSB0aGlzLl9lbmRlZC5iaW5kKHRoaXMpXG4gIH1cblxuICAvKiogQ2hhbmdlIG11c2ljLnZvbHVtZSBhbmQgY3VycmVudGx5IHBsYXlpbmcgYXVkaW8gdm9sdW1lLlxuICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWVcbiAgICovXG4gIHNldCBtdXNpY1ZvbHVtZSh2YWx1ZSkge1xuICAgIHRoaXMubXVzaWMudm9sdW1lID0gdmFsdWVcbiAgICBpZiAodGhpcy5fcGxheWluZykgdGhpcy5fcGxheWluZy5hdWRpby52b2x1bWUgPSB2YWx1ZVxuICB9XG5cbiAgLyoqIENoYW5nZSBtdXNpYy5tdXRlZCBhbmQgbXV0ZS91bm11dGUgY3VycmVudGx5IHBsYXlpbmcgYXVkaW8uXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWVcbiAgICovXG4gIHNldCBtdXNpY011dGVkKHZhbHVlKSB7XG4gICAgdGhpcy5tdXNpYy5tdXRlZCA9IHZhbHVlXG4gICAgaWYgKHRoaXMuX3BsYXlpbmcpIHRoaXMuX3BsYXlpbmcuYXVkaW8ubXV0ZWQgPSB2YWx1ZVxuICAgIGVsc2UgdGhpcy5wbGF5KDAsIDEpXG4gIH1cblxuICBwbGF5KHRyYWNrLCBsb29wKSB7XG4gICAgaWYgKHRoaXMubXVzaWMubXV0ZWQpIHJldHVyblxuXG4gICAgaWYgKCF0aGlzLnRyYWNrc1t0cmFja10gfHwgIXRoaXMudHJhY2tzW3RyYWNrXS5yZWFkeSkge1xuICAgICAgY29uc29sZS5sb2coYFBlbmRpbmcgbXVzaWM6ICR7dHJhY2t9LiAke3RoaXMudHJhY2tzW3RyYWNrXSA/IHRoaXMudHJhY2tzW3RyYWNrXS5uYW1lIDogJyd9YClcbiAgICAgIHRoaXMuX3BlbmRpbmcgPSB0cmFja1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3QgYXVkaW8gPSB0aGlzLnRyYWNrc1t0cmFja10uYXVkaW9cbiAgICBhdWRpby52b2x1bWUgPSB0aGlzLm11c2ljLnZvbHVtZVxuICAgIGF1ZGlvLm11dGVkID0gdGhpcy5tdXNpYy5tdXRlZFxuICAgIGF1ZGlvXG4gICAgICAucGxheSgpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGlmIChsb29wKSBhdWRpby5hZGRFdmVudExpc3RlbmVyKCdlbmRlZCcsIHRoaXMuX2VuZGVkKVxuICAgICAgICB0aGlzLl9wbGF5aW5nID0geyB0cmFjaywgYXVkaW8gfVxuICAgICAgICB0aGlzLnN0YXJ0UGxheUNhbGxiYWNrKHRoaXMudHJhY2tzW3RyYWNrXS5uYW1lKVxuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGNvbnNvbGUud2FybihlcnJvcilcbiAgICAgICAgdGhpcy5tdXNpYy5tdXRlZCA9IHRydWVcbiAgICAgICAgdGhpcy5leGNlcHRpb25DYWxsYmFjaygpXG4gICAgICB9KVxuICB9XG5cbiAgdXNlKG5hbWUpIHtcbiAgICBpZiAodGhpcy5zb3VuZC5tdXRlZCkgcmV0dXJuXG4gICAgaWYgKCF0aGlzLnNvdW5kc1tuYW1lXSkge1xuICAgICAgY29uc29sZS53YXJuKGBObyBzb3VuZDogJHtuYW1lfWApXG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSArPSAxKSB7XG4gICAgICBjb25zdCBhdWRpbyA9IHRoaXMuc291bmRzW25hbWVdW2ldXG4gICAgICBpZiAoYXVkaW8uY3VycmVudFRpbWUgPT09IDAgfHwgYXVkaW8uZW5kZWQpIHtcbiAgICAgICAgYXVkaW8udm9sdW1lID0gdGhpcy5zb3VuZC52b2x1bWVcbiAgICAgICAgYXVkaW8ucGxheSgpLmNhdGNoKGVycm9yID0+IGNvbnNvbGUubG9nKGVycm9yKSlcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2F5KG5hbWUpIHtcbiAgICBpZiAodGhpcy5zb3VuZC5tdXRlZCkgcmV0dXJuXG4gICAgaWYgKCF0aGlzLnNwZWVjaFtuYW1lXSkge1xuICAgICAgY29uc29sZS53YXJuKGBObyBzcGVlY2g6ICR7bmFtZX1gKVxuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIGNvbnN0IGF1ZGlvID0gdGhpcy5zcGVlY2hbbmFtZV1bfn4oTWF0aC5yYW5kb20oKSAqIHRoaXMuc3BlZWNoW25hbWVdLmxlbmd0aCldXG4gICAgYXVkaW8udm9sdW1lID0gdGhpcy5zb3VuZC52b2x1bWVcbiAgICBhdWRpby5wbGF5KCkuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5sb2coZXJyb3IpKVxuICB9XG5cbiAgX2dldFNvdW5kKHBhdGgsIG5hbWUsIHR5cGUgPSAwKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXNcbiAgICBjb25zdCByZXF1ZXN0T2JqID0gbmV3IFJlcXVlc3QocGF0aCwge1xuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0FjY2VwdC1SYW5nZXMnOiAnMTAwMDAwMDAwMCcsXG4gICAgICB9LFxuICAgICAgcmVmZXJyZXJQb2xpY3k6ICduby1yZWZlcnJlcicsXG4gICAgfSlcblxuICAgIGZldGNoKHJlcXVlc3RPYmopXG4gICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZSlcbiAgICAgIC50aGVuKGFzeW5jIGZ1bmN0aW9uIChvdXRjb21lKSB7XG4gICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBvdXRjb21lLmJsb2IoKVxuICAgICAgICBjb25zdCB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKVxuXG4gICAgICAgIHNlbGYuX2xvYWRlZCArPSAxXG4gICAgICAgIHNlbGYucmVhZHkgPSB+figoc2VsZi5fbG9hZGVkIC8gY291bnRUb3RhbCkgKiAxMDApXG5cbiAgICAgICAgaWYgKHR5cGUgPT09ICdzcGVlY2gnKSB7XG4gICAgICAgICAgY29uc3QgYXVkaW8gPSBuZXcgQXVkaW8oKVxuICAgICAgICAgIGF1ZGlvLnNyYyA9IHVybFxuICAgICAgICAgIHNlbGYuc3BlZWNoW25hbWVdLnB1c2goYXVkaW8pXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ211c2ljJykge1xuICAgICAgICAgIGNvbnN0IGF1ZGlvID0gbmV3IEF1ZGlvKClcbiAgICAgICAgICBhdWRpby5zcmMgPSB1cmxcbiAgICAgICAgICBhdWRpby5sb2NhbEluZm8gPSB7IG5hbWUsIHRyYWNrOiBzZWxmLnRyYWNrcy5sZW5ndGggfVxuICAgICAgICAgIGF1ZGlvLmFkZEV2ZW50TGlzdGVuZXIoJ2NhbnBsYXknLCBzZWxmLl9jYW5wbGF5KVxuICAgICAgICAgIHNlbGYudHJhY2tzLnB1c2goeyBhdWRpbywgbmFtZSB9KVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlbGYuc291bmRzW25hbWVdID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogdHlwZSA9PT0gJ211bHRpcGxlJyA/IDEwIDogMSB9LCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhdWRpbyA9IG5ldyBBdWRpbygpXG4gICAgICAgICAgICBhdWRpby5zcmMgPSB1cmxcbiAgICAgICAgICAgIHJldHVybiBhdWRpb1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBzZWxmLnJlYWR5Q2FsbGJhY2soc2VsZi5yZWFkeSwgbmFtZSlcbiAgICAgIH0pXG4gIH1cblxuICBfY2FucGxheShldmVudCkge1xuICAgIGV2ZW50LnRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCdjYW5wbGF5JywgdGhpcy5fY2FucGxheSlcbiAgICBjb25zdCB7IG5hbWUsIHRyYWNrIH0gPSBldmVudC50YXJnZXQubG9jYWxJbmZvXG4gICAgdGhpcy5fbG9hZGVkICs9IDFcbiAgICB0aGlzLnJlYWR5ID0gfn4oKHRoaXMuX2xvYWRlZCAvIGNvdW50VG90YWwpICogMTAwKVxuICAgIHRoaXMudHJhY2tzW3RyYWNrXS5yZWFkeSA9IHRydWVcbiAgICAvLyBjb25zb2xlLmxvZyhgJHt0cmFja30uIENhbiBwbGF5ICcke25hbWV9Jy4gUGVuZGluZzogJHt0aGlzLl9wZW5kaW5nfWApXG5cbiAgICBpZiAodGhpcy5fcGVuZGluZyA9PT0gdHJhY2spIHtcbiAgICAgIHRoaXMucGxheSh0aGlzLl9wZW5kaW5nLCAxKVxuICAgICAgdGhpcy5fcGVuZGluZyA9IG51bGxcbiAgICB9XG4gICAgdGhpcy5yZWFkeUNhbGxiYWNrKHRoaXMucmVhZHksIG5hbWUpXG4gIH1cblxuICBfZW5kZWQoKSB7XG4gICAgaWYgKCF0aGlzLl9wbGF5aW5nKSByZXR1cm5cbiAgICBsZXQgbmV4dCA9ICh0aGlzLl9wbGF5aW5nLnRyYWNrID8/IDApICsgMVxuICAgIGlmIChuZXh0ID49IHRoaXMudHJhY2tzLmxlbmd0aCkgbmV4dCA9IDBcbiAgICB0aGlzLl9wbGF5aW5nID0gbnVsbFxuICAgIHRoaXMucGxheShuZXh0LCAxKVxuICB9XG59XG4iXSwibmFtZXMiOlsic291bmRzIiwiZG90IiwidXJsIiwidHlwZSIsInRvZCIsImNyb3NzIiwid2hvb3NoIiwic2xpZGUiLCJzdGVwIiwibXVzaWMiLCJuYW1lIiwic3BlZWNoIiwid2luIiwibG9vc2UiLCJjb3VudFRvdGFsIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsInZhbHVlcyIsInJlZHVjZSIsImFjYyIsIml0ZW0iLCJTb3VuZCIsInN0YXRpYyIsInNvdW5kIiwidm9sdW1lIiwibXV0ZWQiLCJ0cmFja3MiLCJfbG9hZGVkIiwicmVhZHkiLCJfcGVuZGluZyIsIl9wbGF5aW5nIiwicmVhZHlDYWxsYmFjayIsInN0YXJ0UGxheUNhbGxiYWNrIiwiZXhjZXB0aW9uQ2FsbGJhY2siLCJjb25zdHJ1Y3RvciIsIl9pbnN0YW5jZSIsInRoaXMiLCJmb3JFYWNoIiwiX2dldFNvdW5kIiwiX2NhbnBsYXkiLCJiaW5kIiwiX2VuZGVkIiwibXVzaWNWb2x1bWUiLCJ2YWx1ZSIsImF1ZGlvIiwibXVzaWNNdXRlZCIsInBsYXkiLCJ0cmFjayIsImxvb3AiLCJjb25zb2xlIiwibG9nIiwidGhlbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJjYXRjaCIsImVycm9yIiwid2FybiIsInVzZSIsImkiLCJjdXJyZW50VGltZSIsImVuZGVkIiwic2F5IiwiTWF0aCIsInJhbmRvbSIsInBhdGgiLCJzZWxmIiwicmVxdWVzdE9iaiIsIlJlcXVlc3QiLCJtZXRob2QiLCJoZWFkZXJzIiwicmVmZXJyZXJQb2xpY3kiLCJmZXRjaCIsInJlc3BvbnNlIiwiYXN5bmMiLCJvdXRjb21lIiwiYmxvYiIsIndpbmRvdyIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsIkF1ZGlvIiwic3JjIiwicHVzaCIsImxvY2FsSW5mbyIsIkFycmF5IiwiZnJvbSIsImV2ZW50IiwidGFyZ2V0IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIm5leHQiXSwic291cmNlUm9vdCI6IiJ9