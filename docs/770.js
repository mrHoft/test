"use strict";(self.webpackChunknonograms=self.webpackChunknonograms||[]).push([[770],{4770:(e,t,s)=>{s.r(t),s.d(t,{Sound:()=>a});const i={dot:{url:"./public/dot.ogg",type:"multiple"},tod:{url:"./public/tod.ogg",type:"multiple"},cross:{url:"./public/cross.ogg",type:"multiple"},whoosh:{url:"./public/whoosh01.ogg"},slide:{url:"./public/whoosh02.ogg"},step:{url:"./public/step.ogg",type:"multiple"}},n=[{name:"Intro",url:"./public/track01.ogg"},{name:"Tool In Space",url:"./public/track02.ogg"},{name:"Inside The Bucket",url:"./public/track03.ogg"}],l={win:["./public/win01.ogg"],loose:["./public/loose01.ogg","./public/loose02.ogg","./public/loose03.ogg","./public/loose04.ogg","./public/loose05.ogg"]},o=Object.keys(i).length+2*n.length+Object.values(l).reduce(((e,t)=>e+t.length),0);class a{static _instance;sound={volume:.5,muted:!1};music={volume:.25,muted:!0};sounds={};tracks=[];speech={win:[],loose:[]};_loaded=0;ready=0;_pending=null;_playing=null;readyCallback=()=>{};startPlayCallback=()=>{};exceptionCallback=()=>{};constructor(){if(a._instance)return a._instance;a._instance=this,Object.keys(l).forEach((e=>l[e].forEach((t=>this._getSound(t,e,"speech"))))),Object.keys(i).forEach((e=>this._getSound(i[e].url,e,i[e].type))),n.forEach((e=>this._getSound(e.url,e.name,"music"))),this._canplay=this._canplay.bind(this),this._ended=this._ended.bind(this)}set musicVolume(e){this.music.volume=e,this._playing&&(this._playing.audio.volume=e)}set musicMuted(e){this.music.muted=e,this._playing?this._playing.audio.muted=e:this.play(0,1)}play(e,t){if(this.music.muted)return;if(!this.tracks[e]||!this.tracks[e].ready)return console.log(`Pending music: ${e}. ${this.tracks[e]?this.tracks[e].name:""}`),void(this._pending=e);const s=this.tracks[e].audio;s.volume=this.music.volume,s.muted=this.music.muted,s.play().then((()=>{t&&s.addEventListener("ended",this._ended),this._playing={track:e,audio:s},this.startPlayCallback(this.tracks[e].name)})).catch((e=>{console.warn(e),this.music.muted=!0,this.exceptionCallback()}))}use(e){if(!this.sound.muted&&this.sounds[e])for(let t=0;t<10;t+=1){const s=this.sounds[e][t];if(0===s.currentTime||s.ended)return s.volume=this.sound.volume,void s.play().catch((e=>console.log(e)))}}say(e){if(this.sound.muted)return;if(!this.speech[e])return void console.warn(`No speech: ${e}`);const t=this.speech[e][~~(Math.random()*this.speech[e].length)];t.volume=this.sound.volume,t.play().catch((e=>console.log(e)))}_getSound(e,t,s=0){const i=this,n=new Request(e,{method:"GET",headers:{"Accept-Ranges":"1000000000"},referrerPolicy:"no-referrer"});fetch(n).then((e=>e)).then((async function(e){const n=await e.blob(),l=window.URL.createObjectURL(n);if(i._loaded+=1,i.ready=~~(i._loaded/o*100),"speech"===s){const e=new Audio;e.src=l,i.speech[t].push(e)}else if("music"===s){const e=new Audio;e.src=l,e.localInfo={name:t,track:i.tracks.length},e.addEventListener("canplay",i._canplay),i.tracks.push({audio:e,name:t})}else i.sounds[t]=Array.from({length:"multiple"===s?10:1},(()=>{const e=new Audio;return e.src=l,e}));i.readyCallback(i.ready,t)}))}_canplay(e){e.target.removeEventListener("canplay",this._canplay);const{name:t,track:s}=e.target.localInfo;this._loaded+=1,this.ready=~~(this._loaded/o*100),this.tracks[s].ready=!0,this._pending===s&&(this.play(this._pending,1),this._pending=null),this.readyCallback(this.ready,t)}_ended(){if(!this._playing)return;let e=(this._playing.track??0)+1;e>=this.tracks.length&&(e=0),this._playing=null,this.play(e,1)}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQUtOLFNBQVNpQixPQUFTLEdBQUssRUFDcEN3QyxHQUFRbkQsS0FBS1YsT0FBT1YsU0FBUXVFLEVBQU8sR0FDdkNuRCxLQUFLTixTQUFXLEtBQ2hCTSxLQUFLVSxLQUFLeUMsRUFBTSxFQUNsQixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbm9ub2dyYW1zLy4vc3JjL3V0aWxzL3NvdW5kLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNvdW5kcyA9IHtcbiAgZG90OiB7IHVybDogJy4vcHVibGljL2RvdC5vZ2cnLCB0eXBlOiAnbXVsdGlwbGUnIH0sXG4gIHRvZDogeyB1cmw6ICcuL3B1YmxpYy90b2Qub2dnJywgdHlwZTogJ211bHRpcGxlJyB9LFxuICBjcm9zczogeyB1cmw6ICcuL3B1YmxpYy9jcm9zcy5vZ2cnLCB0eXBlOiAnbXVsdGlwbGUnIH0sXG4gIHdob29zaDogeyB1cmw6ICcuL3B1YmxpYy93aG9vc2gwMS5vZ2cnIH0sXG4gIHNsaWRlOiB7IHVybDogJy4vcHVibGljL3dob29zaDAyLm9nZycgfSxcbiAgc3RlcDogeyB1cmw6ICcuL3B1YmxpYy9zdGVwLm9nZycsIHR5cGU6ICdtdWx0aXBsZScgfSxcbn1cblxuY29uc3QgbXVzaWMgPSBbXG4gIHtcbiAgICBuYW1lOiAnSW50cm8nLFxuICAgIHVybDogJy4vcHVibGljL3RyYWNrMDEub2dnJyxcbiAgfSxcbiAge1xuICAgIG5hbWU6ICdUb29sIEluIFNwYWNlJyxcbiAgICB1cmw6ICcuL3B1YmxpYy90cmFjazAyLm9nZycsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiAnSW5zaWRlIFRoZSBCdWNrZXQnLFxuICAgIHVybDogJy4vcHVibGljL3RyYWNrMDMub2dnJyxcbiAgfSxcbl1cblxuY29uc3Qgc3BlZWNoID0ge1xuICB3aW46IFsnLi9wdWJsaWMvd2luMDEub2dnJ10sXG4gIGxvb3NlOiBbJy4vcHVibGljL2xvb3NlMDEub2dnJywgJy4vcHVibGljL2xvb3NlMDIub2dnJywgJy4vcHVibGljL2xvb3NlMDMub2dnJywgJy4vcHVibGljL2xvb3NlMDQub2dnJywgJy4vcHVibGljL2xvb3NlMDUub2dnJ10sXG59XG5cbmNvbnN0IGNvdW50VG90YWwgPSBPYmplY3Qua2V5cyhzb3VuZHMpLmxlbmd0aCArIG11c2ljLmxlbmd0aCAqIDIgKyBPYmplY3QudmFsdWVzKHNwZWVjaCkucmVkdWNlKChhY2MsIGl0ZW0pID0+IGFjYyArIGl0ZW0ubGVuZ3RoLCAwKVxuXG5leHBvcnQgY2xhc3MgU291bmQge1xuICBzdGF0aWMgX2luc3RhbmNlXG4gIHNvdW5kID0geyB2b2x1bWU6IDAuNSwgbXV0ZWQ6IGZhbHNlIH1cbiAgbXVzaWMgPSB7IHZvbHVtZTogMC4yNSwgbXV0ZWQ6IHRydWUgfVxuICBzb3VuZHMgPSB7fVxuICB0cmFja3MgPSBbXVxuICBzcGVlY2ggPSB7IHdpbjogW10sIGxvb3NlOiBbXSB9XG4gIF9sb2FkZWQgPSAwXG4gIHJlYWR5ID0gMFxuICBfcGVuZGluZyA9IG51bGxcbiAgX3BsYXlpbmcgPSBudWxsXG4gIHJlYWR5Q2FsbGJhY2sgPSAoKSA9PiB7fVxuICBzdGFydFBsYXlDYWxsYmFjayA9ICgpID0+IHt9XG4gIGV4Y2VwdGlvbkNhbGxiYWNrID0gKCkgPT4ge31cblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBpZiAoU291bmQuX2luc3RhbmNlKSByZXR1cm4gU291bmQuX2luc3RhbmNlXG4gICAgU291bmQuX2luc3RhbmNlID0gdGhpc1xuICAgIE9iamVjdC5rZXlzKHNwZWVjaCkuZm9yRWFjaChuYW1lID0+IHNwZWVjaFtuYW1lXS5mb3JFYWNoKHVybCA9PiB0aGlzLl9nZXRTb3VuZCh1cmwsIG5hbWUsICdzcGVlY2gnKSkpXG4gICAgT2JqZWN0LmtleXMoc291bmRzKS5mb3JFYWNoKG5hbWUgPT4gdGhpcy5fZ2V0U291bmQoc291bmRzW25hbWVdLnVybCwgbmFtZSwgc291bmRzW25hbWVdLnR5cGUpKVxuICAgIG11c2ljLmZvckVhY2goaXRlbSA9PiB0aGlzLl9nZXRTb3VuZChpdGVtLnVybCwgaXRlbS5uYW1lLCAnbXVzaWMnKSlcblxuICAgIHRoaXMuX2NhbnBsYXkgPSB0aGlzLl9jYW5wbGF5LmJpbmQodGhpcylcbiAgICB0aGlzLl9lbmRlZCA9IHRoaXMuX2VuZGVkLmJpbmQodGhpcylcbiAgfVxuXG4gIC8qKiBDaGFuZ2UgbXVzaWMudm9sdW1lIGFuZCBjdXJyZW50bHkgcGxheWluZyBhdWRpbyB2b2x1bWUuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZVxuICAgKi9cbiAgc2V0IG11c2ljVm9sdW1lKHZhbHVlKSB7XG4gICAgdGhpcy5tdXNpYy52b2x1bWUgPSB2YWx1ZVxuICAgIGlmICh0aGlzLl9wbGF5aW5nKSB0aGlzLl9wbGF5aW5nLmF1ZGlvLnZvbHVtZSA9IHZhbHVlXG4gIH1cblxuICAvKiogQ2hhbmdlIG11c2ljLm11dGVkIGFuZCBtdXRlL3VubXV0ZSBjdXJyZW50bHkgcGxheWluZyBhdWRpby5cbiAgICogQHBhcmFtIHtib29sZWFufSB2YWx1ZVxuICAgKi9cbiAgc2V0IG11c2ljTXV0ZWQodmFsdWUpIHtcbiAgICB0aGlzLm11c2ljLm11dGVkID0gdmFsdWVcbiAgICBpZiAodGhpcy5fcGxheWluZykgdGhpcy5fcGxheWluZy5hdWRpby5tdXRlZCA9IHZhbHVlXG4gICAgZWxzZSB0aGlzLnBsYXkoMCwgMSlcbiAgfVxuXG4gIHBsYXkodHJhY2ssIGxvb3ApIHtcbiAgICBpZiAodGhpcy5tdXNpYy5tdXRlZCkgcmV0dXJuXG5cbiAgICBpZiAoIXRoaXMudHJhY2tzW3RyYWNrXSB8fCAhdGhpcy50cmFja3NbdHJhY2tdLnJlYWR5KSB7XG4gICAgICBjb25zb2xlLmxvZyhgUGVuZGluZyBtdXNpYzogJHt0cmFja30uICR7dGhpcy50cmFja3NbdHJhY2tdID8gdGhpcy50cmFja3NbdHJhY2tdLm5hbWUgOiAnJ31gKVxuICAgICAgdGhpcy5fcGVuZGluZyA9IHRyYWNrXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCBhdWRpbyA9IHRoaXMudHJhY2tzW3RyYWNrXS5hdWRpb1xuICAgIGF1ZGlvLnZvbHVtZSA9IHRoaXMubXVzaWMudm9sdW1lXG4gICAgYXVkaW8ubXV0ZWQgPSB0aGlzLm11c2ljLm11dGVkXG4gICAgYXVkaW9cbiAgICAgIC5wbGF5KClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgaWYgKGxvb3ApIGF1ZGlvLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgdGhpcy5fZW5kZWQpXG4gICAgICAgIHRoaXMuX3BsYXlpbmcgPSB7IHRyYWNrLCBhdWRpbyB9XG4gICAgICAgIHRoaXMuc3RhcnRQbGF5Q2FsbGJhY2sodGhpcy50cmFja3NbdHJhY2tdLm5hbWUpXG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgY29uc29sZS53YXJuKGVycm9yKVxuICAgICAgICB0aGlzLm11c2ljLm11dGVkID0gdHJ1ZVxuICAgICAgICB0aGlzLmV4Y2VwdGlvbkNhbGxiYWNrKClcbiAgICAgIH0pXG4gIH1cblxuICB1c2UobmFtZSkge1xuICAgIGlmICh0aGlzLnNvdW5kLm11dGVkKSByZXR1cm5cbiAgICBpZiAoIXRoaXMuc291bmRzW25hbWVdKSB7XG4gICAgICAvLyBjb25zb2xlLndhcm4oYE5vIHNvdW5kOiAke25hbWV9YClcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpICs9IDEpIHtcbiAgICAgIGNvbnN0IGF1ZGlvID0gdGhpcy5zb3VuZHNbbmFtZV1baV1cbiAgICAgIGlmIChhdWRpby5jdXJyZW50VGltZSA9PT0gMCB8fCBhdWRpby5lbmRlZCkge1xuICAgICAgICBhdWRpby52b2x1bWUgPSB0aGlzLnNvdW5kLnZvbHVtZVxuICAgICAgICBhdWRpby5wbGF5KCkuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5sb2coZXJyb3IpKVxuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzYXkobmFtZSkge1xuICAgIGlmICh0aGlzLnNvdW5kLm11dGVkKSByZXR1cm5cbiAgICBpZiAoIXRoaXMuc3BlZWNoW25hbWVdKSB7XG4gICAgICBjb25zb2xlLndhcm4oYE5vIHNwZWVjaDogJHtuYW1lfWApXG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgY29uc3QgYXVkaW8gPSB0aGlzLnNwZWVjaFtuYW1lXVt+fihNYXRoLnJhbmRvbSgpICogdGhpcy5zcGVlY2hbbmFtZV0ubGVuZ3RoKV1cbiAgICBhdWRpby52b2x1bWUgPSB0aGlzLnNvdW5kLnZvbHVtZVxuICAgIGF1ZGlvLnBsYXkoKS5jYXRjaChlcnJvciA9PiBjb25zb2xlLmxvZyhlcnJvcikpXG4gIH1cblxuICBfZ2V0U291bmQocGF0aCwgbmFtZSwgdHlwZSA9IDApIHtcbiAgICBjb25zdCBzZWxmID0gdGhpc1xuICAgIGNvbnN0IHJlcXVlc3RPYmogPSBuZXcgUmVxdWVzdChwYXRoLCB7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQWNjZXB0LVJhbmdlcyc6ICcxMDAwMDAwMDAwJyxcbiAgICAgIH0sXG4gICAgICByZWZlcnJlclBvbGljeTogJ25vLXJlZmVycmVyJyxcbiAgICB9KVxuXG4gICAgZmV0Y2gocmVxdWVzdE9iailcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlKVxuICAgICAgLnRoZW4oYXN5bmMgZnVuY3Rpb24gKG91dGNvbWUpIHtcbiAgICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IG91dGNvbWUuYmxvYigpXG4gICAgICAgIGNvbnN0IHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpXG5cbiAgICAgICAgc2VsZi5fbG9hZGVkICs9IDFcbiAgICAgICAgc2VsZi5yZWFkeSA9IH5+KChzZWxmLl9sb2FkZWQgLyBjb3VudFRvdGFsKSAqIDEwMClcblxuICAgICAgICBpZiAodHlwZSA9PT0gJ3NwZWVjaCcpIHtcbiAgICAgICAgICBjb25zdCBhdWRpbyA9IG5ldyBBdWRpbygpXG4gICAgICAgICAgYXVkaW8uc3JjID0gdXJsXG4gICAgICAgICAgc2VsZi5zcGVlY2hbbmFtZV0ucHVzaChhdWRpbylcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnbXVzaWMnKSB7XG4gICAgICAgICAgY29uc3QgYXVkaW8gPSBuZXcgQXVkaW8oKVxuICAgICAgICAgIGF1ZGlvLnNyYyA9IHVybFxuICAgICAgICAgIGF1ZGlvLmxvY2FsSW5mbyA9IHsgbmFtZSwgdHJhY2s6IHNlbGYudHJhY2tzLmxlbmd0aCB9XG4gICAgICAgICAgYXVkaW8uYWRkRXZlbnRMaXN0ZW5lcignY2FucGxheScsIHNlbGYuX2NhbnBsYXkpXG4gICAgICAgICAgc2VsZi50cmFja3MucHVzaCh7IGF1ZGlvLCBuYW1lIH0pXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2VsZi5zb3VuZHNbbmFtZV0gPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiB0eXBlID09PSAnbXVsdGlwbGUnID8gMTAgOiAxIH0sICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGF1ZGlvID0gbmV3IEF1ZGlvKClcbiAgICAgICAgICAgIGF1ZGlvLnNyYyA9IHVybFxuICAgICAgICAgICAgcmV0dXJuIGF1ZGlvXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGYucmVhZHlDYWxsYmFjayhzZWxmLnJlYWR5LCBuYW1lKVxuICAgICAgfSlcbiAgfVxuXG4gIF9jYW5wbGF5KGV2ZW50KSB7XG4gICAgZXZlbnQudGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NhbnBsYXknLCB0aGlzLl9jYW5wbGF5KVxuICAgIGNvbnN0IHsgbmFtZSwgdHJhY2sgfSA9IGV2ZW50LnRhcmdldC5sb2NhbEluZm9cbiAgICB0aGlzLl9sb2FkZWQgKz0gMVxuICAgIHRoaXMucmVhZHkgPSB+figodGhpcy5fbG9hZGVkIC8gY291bnRUb3RhbCkgKiAxMDApXG4gICAgdGhpcy50cmFja3NbdHJhY2tdLnJlYWR5ID0gdHJ1ZVxuICAgIC8vIGNvbnNvbGUubG9nKGAke3RyYWNrfS4gQ2FuIHBsYXkgJyR7bmFtZX0nLiBQZW5kaW5nOiAke3RoaXMuX3BlbmRpbmd9YClcblxuICAgIGlmICh0aGlzLl9wZW5kaW5nID09PSB0cmFjaykge1xuICAgICAgdGhpcy5wbGF5KHRoaXMuX3BlbmRpbmcsIDEpXG4gICAgICB0aGlzLl9wZW5kaW5nID0gbnVsbFxuICAgIH1cbiAgICB0aGlzLnJlYWR5Q2FsbGJhY2sodGhpcy5yZWFkeSwgbmFtZSlcbiAgfVxuXG4gIF9lbmRlZCgpIHtcbiAgICBpZiAoIXRoaXMuX3BsYXlpbmcpIHJldHVyblxuICAgIGxldCBuZXh0ID0gKHRoaXMuX3BsYXlpbmcudHJhY2sgPz8gMCkgKyAxXG4gICAgaWYgKG5leHQgPj0gdGhpcy50cmFja3MubGVuZ3RoKSBuZXh0ID0gMFxuICAgIHRoaXMuX3BsYXlpbmcgPSBudWxsXG4gICAgdGhpcy5wbGF5KG5leHQsIDEpXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJzb3VuZHMiLCJkb3QiLCJ1cmwiLCJ0eXBlIiwidG9kIiwiY3Jvc3MiLCJ3aG9vc2giLCJzbGlkZSIsInN0ZXAiLCJtdXNpYyIsIm5hbWUiLCJzcGVlY2giLCJ3aW4iLCJsb29zZSIsImNvdW50VG90YWwiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwidmFsdWVzIiwicmVkdWNlIiwiYWNjIiwiaXRlbSIsIlNvdW5kIiwic3RhdGljIiwic291bmQiLCJ2b2x1bWUiLCJtdXRlZCIsInRyYWNrcyIsIl9sb2FkZWQiLCJyZWFkeSIsIl9wZW5kaW5nIiwiX3BsYXlpbmciLCJyZWFkeUNhbGxiYWNrIiwic3RhcnRQbGF5Q2FsbGJhY2siLCJleGNlcHRpb25DYWxsYmFjayIsImNvbnN0cnVjdG9yIiwiX2luc3RhbmNlIiwidGhpcyIsImZvckVhY2giLCJfZ2V0U291bmQiLCJfY2FucGxheSIsImJpbmQiLCJfZW5kZWQiLCJtdXNpY1ZvbHVtZSIsInZhbHVlIiwiYXVkaW8iLCJtdXNpY011dGVkIiwicGxheSIsInRyYWNrIiwibG9vcCIsImNvbnNvbGUiLCJsb2ciLCJ0aGVuIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNhdGNoIiwiZXJyb3IiLCJ3YXJuIiwidXNlIiwiaSIsImN1cnJlbnRUaW1lIiwiZW5kZWQiLCJzYXkiLCJNYXRoIiwicmFuZG9tIiwicGF0aCIsInNlbGYiLCJyZXF1ZXN0T2JqIiwiUmVxdWVzdCIsIm1ldGhvZCIsImhlYWRlcnMiLCJyZWZlcnJlclBvbGljeSIsImZldGNoIiwicmVzcG9uc2UiLCJhc3luYyIsIm91dGNvbWUiLCJibG9iIiwid2luZG93IiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwiQXVkaW8iLCJzcmMiLCJwdXNoIiwibG9jYWxJbmZvIiwiQXJyYXkiLCJmcm9tIiwiZXZlbnQiLCJ0YXJnZXQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwibmV4dCJdLCJzb3VyY2VSb290IjoiIn0=