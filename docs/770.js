"use strict";(self.webpackChunknonograms=self.webpackChunknonograms||[]).push([[770],{4770:(e,t,s)=>{s.r(t),s.d(t,{Sound:()=>a});const i={dot:{url:"./public/dot.ogg",type:"multiple"},cross:{url:"./public/cross.ogg",type:"multiple"},whoosh:{url:"./public/whoosh01.ogg"},slide:{url:"./public/whoosh02.ogg"},step:{url:"./public/step.ogg",type:"multiple"}},n=[{name:"Intro",url:"./public/track01.ogg"},{name:"Tool In Space",url:"./public/track02.ogg"},{name:"Inside The Bucket",url:"./public/track03.ogg"}],o={win:["./public/win01.ogg"],loose:["./public/loose01.ogg","./public/loose02.ogg","./public/loose03.ogg","./public/loose04.ogg","./public/loose05.ogg"]},l=Object.keys(i).length+2*n.length+Object.values(o).reduce(((e,t)=>e+t.length),0);class a{static _instance;sound={volume:.5,muted:!1};music={volume:.25,muted:!0};sounds={};tracks=[];speech={win:[],loose:[]};_loaded=0;ready=0;_pending=null;_playing=null;readyCallback=()=>{};startPlayCallback=()=>{};exceptionCallback=()=>{};constructor(){if(a._instance)return a._instance;a._instance=this,Object.keys(o).forEach((e=>o[e].forEach((t=>this._getSound(t,e,"speech"))))),Object.keys(i).forEach((e=>this._getSound(i[e].url,e,i[e].type))),n.forEach((e=>this._getSound(e.url,e.name,"music"))),this._canplay=this._canplay.bind(this),this._ended=this._ended.bind(this)}set musicVolume(e){this.music.volume=e,this._playing&&(this._playing.audio.volume=e)}set musicMuted(e){this.music.muted=e,this._playing?this._playing.audio.muted=e:this.play(0,1)}play(e,t){if(this.music.muted)return;if(!this.tracks[e]||!this.tracks[e].ready)return console.log(`Pending music: ${e}. ${this.tracks[e]?this.tracks[e].name:""}`),void(this._pending=e);const s=this.tracks[e].audio;s.volume=this.music.volume,s.muted=this.music.muted,s.play().then((()=>{t&&s.addEventListener("ended",this._ended),this._playing={track:e,audio:s},this.startPlayCallback(this.tracks[e].name)})).catch((e=>{console.warn(e),this.music.muted=!0,this.exceptionCallback()}))}use(e){if(!this.sound.muted)if(this.sounds[e])for(let t=0;t<10;t+=1){const s=this.sounds[e][t];if(0===s.currentTime||s.ended)return s.volume=this.sound.volume,void s.play().catch((e=>console.log(e)))}else console.warn(`No sound: ${e}`)}say(e){if(this.sound.muted)return;if(!this.speech[e])return void console.warn(`No speech: ${e}`);const t=this.speech[e][~~(Math.random()*this.speech[e].length)];t.volume=this.sound.volume,t.play().catch((e=>console.log(e)))}_getSound(e,t,s=0){const i=this,n=new Request(e,{method:"GET",headers:{"Accept-Ranges":"1000000000"},referrerPolicy:"no-referrer"});fetch(n).then((e=>e)).then((async function(e){const n=await e.blob(),o=window.URL.createObjectURL(n);if(i._loaded+=1,i.ready=~~(i._loaded/l*100),"speech"===s){const e=new Audio;e.src=o,i.speech[t].push(e)}else if("music"===s){const e=new Audio;e.src=o,e.localInfo={name:t,track:i.tracks.length},e.addEventListener("canplay",i._canplay),i.tracks.push({audio:e,name:t})}else i.sounds[t]=Array.from({length:"multiple"===s?10:1},(()=>{const e=new Audio;return e.src=o,e}));i.readyCallback(i.ready,t)}))}_canplay(e){e.target.removeEventListener("canplay",this._canplay);const{name:t,track:s}=e.target.localInfo;this._loaded+=1,this.ready=~~(this._loaded/l*100),this.tracks[s].ready=!0,this._pending===s&&(this.play(this._pending,1),this._pending=null),this.readyCallback(this.ready,t)}_ended(){if(!this._playing)return;let e=(this._playing.track??0)+1;e>=this.tracks.length&&(e=0),this._playing=null,this.play(e,1)}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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U0FBU2lCLE9BQVMsR0FBSyxFQUNwQ3dDLEdBQVFuRCxLQUFLVixPQUFPVixTQUFRdUUsRUFBTyxHQUN2Q25ELEtBQUtOLFNBQVcsS0FDaEJNLEtBQUtVLEtBQUt5QyxFQUFNLEVBQ2xCLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ub25vZ3JhbXMvLi9zcmMvdXRpbHMvc291bmQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc291bmRzID0ge1xuICBkb3Q6IHsgdXJsOiAnLi9wdWJsaWMvZG90Lm9nZycsIHR5cGU6ICdtdWx0aXBsZScgfSxcbiAgY3Jvc3M6IHsgdXJsOiAnLi9wdWJsaWMvY3Jvc3Mub2dnJywgdHlwZTogJ211bHRpcGxlJyB9LFxuICB3aG9vc2g6IHsgdXJsOiAnLi9wdWJsaWMvd2hvb3NoMDEub2dnJyB9LFxuICBzbGlkZTogeyB1cmw6ICcuL3B1YmxpYy93aG9vc2gwMi5vZ2cnIH0sXG4gIHN0ZXA6IHsgdXJsOiAnLi9wdWJsaWMvc3RlcC5vZ2cnLCB0eXBlOiAnbXVsdGlwbGUnIH0sXG59XG5cbmNvbnN0IG11c2ljID0gW1xuICB7XG4gICAgbmFtZTogJ0ludHJvJyxcbiAgICB1cmw6ICcuL3B1YmxpYy90cmFjazAxLm9nZycsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiAnVG9vbCBJbiBTcGFjZScsXG4gICAgdXJsOiAnLi9wdWJsaWMvdHJhY2swMi5vZ2cnLFxuICB9LFxuICB7XG4gICAgbmFtZTogJ0luc2lkZSBUaGUgQnVja2V0JyxcbiAgICB1cmw6ICcuL3B1YmxpYy90cmFjazAzLm9nZycsXG4gIH0sXG5dXG5cbmNvbnN0IHNwZWVjaCA9IHtcbiAgd2luOiBbJy4vcHVibGljL3dpbjAxLm9nZyddLFxuICBsb29zZTogWycuL3B1YmxpYy9sb29zZTAxLm9nZycsICcuL3B1YmxpYy9sb29zZTAyLm9nZycsICcuL3B1YmxpYy9sb29zZTAzLm9nZycsICcuL3B1YmxpYy9sb29zZTA0Lm9nZycsICcuL3B1YmxpYy9sb29zZTA1Lm9nZyddLFxufVxuXG5jb25zdCBjb3VudFRvdGFsID0gT2JqZWN0LmtleXMoc291bmRzKS5sZW5ndGggKyBtdXNpYy5sZW5ndGggKiAyICsgT2JqZWN0LnZhbHVlcyhzcGVlY2gpLnJlZHVjZSgoYWNjLCBpdGVtKSA9PiBhY2MgKyBpdGVtLmxlbmd0aCwgMClcblxuZXhwb3J0IGNsYXNzIFNvdW5kIHtcbiAgc3RhdGljIF9pbnN0YW5jZVxuICBzb3VuZCA9IHsgdm9sdW1lOiAwLjUsIG11dGVkOiBmYWxzZSB9XG4gIG11c2ljID0geyB2b2x1bWU6IDAuMjUsIG11dGVkOiB0cnVlIH1cbiAgc291bmRzID0ge31cbiAgdHJhY2tzID0gW11cbiAgc3BlZWNoID0geyB3aW46IFtdLCBsb29zZTogW10gfVxuICBfbG9hZGVkID0gMFxuICByZWFkeSA9IDBcbiAgX3BlbmRpbmcgPSBudWxsXG4gIF9wbGF5aW5nID0gbnVsbFxuICByZWFkeUNhbGxiYWNrID0gKCkgPT4ge31cbiAgc3RhcnRQbGF5Q2FsbGJhY2sgPSAoKSA9PiB7fVxuICBleGNlcHRpb25DYWxsYmFjayA9ICgpID0+IHt9XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgaWYgKFNvdW5kLl9pbnN0YW5jZSkgcmV0dXJuIFNvdW5kLl9pbnN0YW5jZVxuICAgIFNvdW5kLl9pbnN0YW5jZSA9IHRoaXNcbiAgICBPYmplY3Qua2V5cyhzcGVlY2gpLmZvckVhY2gobmFtZSA9PiBzcGVlY2hbbmFtZV0uZm9yRWFjaCh1cmwgPT4gdGhpcy5fZ2V0U291bmQodXJsLCBuYW1lLCAnc3BlZWNoJykpKVxuICAgIE9iamVjdC5rZXlzKHNvdW5kcykuZm9yRWFjaChuYW1lID0+IHRoaXMuX2dldFNvdW5kKHNvdW5kc1tuYW1lXS51cmwsIG5hbWUsIHNvdW5kc1tuYW1lXS50eXBlKSlcbiAgICBtdXNpYy5mb3JFYWNoKGl0ZW0gPT4gdGhpcy5fZ2V0U291bmQoaXRlbS51cmwsIGl0ZW0ubmFtZSwgJ211c2ljJykpXG5cbiAgICB0aGlzLl9jYW5wbGF5ID0gdGhpcy5fY2FucGxheS5iaW5kKHRoaXMpXG4gICAgdGhpcy5fZW5kZWQgPSB0aGlzLl9lbmRlZC5iaW5kKHRoaXMpXG4gIH1cblxuICAvKiogQ2hhbmdlIG11c2ljLnZvbHVtZSBhbmQgY3VycmVudGx5IHBsYXlpbmcgYXVkaW8gdm9sdW1lLlxuICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWVcbiAgICovXG4gIHNldCBtdXNpY1ZvbHVtZSh2YWx1ZSkge1xuICAgIHRoaXMubXVzaWMudm9sdW1lID0gdmFsdWVcbiAgICBpZiAodGhpcy5fcGxheWluZykgdGhpcy5fcGxheWluZy5hdWRpby52b2x1bWUgPSB2YWx1ZVxuICB9XG5cbiAgLyoqIENoYW5nZSBtdXNpYy5tdXRlZCBhbmQgbXV0ZS91bm11dGUgY3VycmVudGx5IHBsYXlpbmcgYXVkaW8uXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWVcbiAgICovXG4gIHNldCBtdXNpY011dGVkKHZhbHVlKSB7XG4gICAgdGhpcy5tdXNpYy5tdXRlZCA9IHZhbHVlXG4gICAgaWYgKHRoaXMuX3BsYXlpbmcpIHRoaXMuX3BsYXlpbmcuYXVkaW8ubXV0ZWQgPSB2YWx1ZVxuICAgIGVsc2UgdGhpcy5wbGF5KDAsIDEpXG4gIH1cblxuICBwbGF5KHRyYWNrLCBsb29wKSB7XG4gICAgaWYgKHRoaXMubXVzaWMubXV0ZWQpIHJldHVyblxuXG4gICAgaWYgKCF0aGlzLnRyYWNrc1t0cmFja10gfHwgIXRoaXMudHJhY2tzW3RyYWNrXS5yZWFkeSkge1xuICAgICAgY29uc29sZS5sb2coYFBlbmRpbmcgbXVzaWM6ICR7dHJhY2t9LiAke3RoaXMudHJhY2tzW3RyYWNrXSA/IHRoaXMudHJhY2tzW3RyYWNrXS5uYW1lIDogJyd9YClcbiAgICAgIHRoaXMuX3BlbmRpbmcgPSB0cmFja1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3QgYXVkaW8gPSB0aGlzLnRyYWNrc1t0cmFja10uYXVkaW9cbiAgICBhdWRpby52b2x1bWUgPSB0aGlzLm11c2ljLnZvbHVtZVxuICAgIGF1ZGlvLm11dGVkID0gdGhpcy5tdXNpYy5tdXRlZFxuICAgIGF1ZGlvXG4gICAgICAucGxheSgpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGlmIChsb29wKSBhdWRpby5hZGRFdmVudExpc3RlbmVyKCdlbmRlZCcsIHRoaXMuX2VuZGVkKVxuICAgICAgICB0aGlzLl9wbGF5aW5nID0geyB0cmFjaywgYXVkaW8gfVxuICAgICAgICB0aGlzLnN0YXJ0UGxheUNhbGxiYWNrKHRoaXMudHJhY2tzW3RyYWNrXS5uYW1lKVxuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGNvbnNvbGUud2FybihlcnJvcilcbiAgICAgICAgdGhpcy5tdXNpYy5tdXRlZCA9IHRydWVcbiAgICAgICAgdGhpcy5leGNlcHRpb25DYWxsYmFjaygpXG4gICAgICB9KVxuICB9XG5cbiAgdXNlKG5hbWUpIHtcbiAgICBpZiAodGhpcy5zb3VuZC5tdXRlZCkgcmV0dXJuXG4gICAgaWYgKCF0aGlzLnNvdW5kc1tuYW1lXSkge1xuICAgICAgY29uc29sZS53YXJuKGBObyBzb3VuZDogJHtuYW1lfWApXG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSArPSAxKSB7XG4gICAgICBjb25zdCBhdWRpbyA9IHRoaXMuc291bmRzW25hbWVdW2ldXG4gICAgICBpZiAoYXVkaW8uY3VycmVudFRpbWUgPT09IDAgfHwgYXVkaW8uZW5kZWQpIHtcbiAgICAgICAgYXVkaW8udm9sdW1lID0gdGhpcy5zb3VuZC52b2x1bWVcbiAgICAgICAgYXVkaW8ucGxheSgpLmNhdGNoKGVycm9yID0+IGNvbnNvbGUubG9nKGVycm9yKSlcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2F5KG5hbWUpIHtcbiAgICBpZiAodGhpcy5zb3VuZC5tdXRlZCkgcmV0dXJuXG4gICAgaWYgKCF0aGlzLnNwZWVjaFtuYW1lXSkge1xuICAgICAgY29uc29sZS53YXJuKGBObyBzcGVlY2g6ICR7bmFtZX1gKVxuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIGNvbnN0IGF1ZGlvID0gdGhpcy5zcGVlY2hbbmFtZV1bfn4oTWF0aC5yYW5kb20oKSAqIHRoaXMuc3BlZWNoW25hbWVdLmxlbmd0aCldXG4gICAgYXVkaW8udm9sdW1lID0gdGhpcy5zb3VuZC52b2x1bWVcbiAgICBhdWRpby5wbGF5KCkuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5sb2coZXJyb3IpKVxuICB9XG5cbiAgX2dldFNvdW5kKHBhdGgsIG5hbWUsIHR5cGUgPSAwKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXNcbiAgICBjb25zdCByZXF1ZXN0T2JqID0gbmV3IFJlcXVlc3QocGF0aCwge1xuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0FjY2VwdC1SYW5nZXMnOiAnMTAwMDAwMDAwMCcsXG4gICAgICB9LFxuICAgICAgcmVmZXJyZXJQb2xpY3k6ICduby1yZWZlcnJlcicsXG4gICAgfSlcblxuICAgIGZldGNoKHJlcXVlc3RPYmopXG4gICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZSlcbiAgICAgIC50aGVuKGFzeW5jIGZ1bmN0aW9uIChvdXRjb21lKSB7XG4gICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBvdXRjb21lLmJsb2IoKVxuICAgICAgICBjb25zdCB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKVxuXG4gICAgICAgIHNlbGYuX2xvYWRlZCArPSAxXG4gICAgICAgIHNlbGYucmVhZHkgPSB+figoc2VsZi5fbG9hZGVkIC8gY291bnRUb3RhbCkgKiAxMDApXG5cbiAgICAgICAgaWYgKHR5cGUgPT09ICdzcGVlY2gnKSB7XG4gICAgICAgICAgY29uc3QgYXVkaW8gPSBuZXcgQXVkaW8oKVxuICAgICAgICAgIGF1ZGlvLnNyYyA9IHVybFxuICAgICAgICAgIHNlbGYuc3BlZWNoW25hbWVdLnB1c2goYXVkaW8pXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ211c2ljJykge1xuICAgICAgICAgIGNvbnN0IGF1ZGlvID0gbmV3IEF1ZGlvKClcbiAgICAgICAgICBhdWRpby5zcmMgPSB1cmxcbiAgICAgICAgICBhdWRpby5sb2NhbEluZm8gPSB7IG5hbWUsIHRyYWNrOiBzZWxmLnRyYWNrcy5sZW5ndGggfVxuICAgICAgICAgIGF1ZGlvLmFkZEV2ZW50TGlzdGVuZXIoJ2NhbnBsYXknLCBzZWxmLl9jYW5wbGF5KVxuICAgICAgICAgIHNlbGYudHJhY2tzLnB1c2goeyBhdWRpbywgbmFtZSB9KVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlbGYuc291bmRzW25hbWVdID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogdHlwZSA9PT0gJ211bHRpcGxlJyA/IDEwIDogMSB9LCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhdWRpbyA9IG5ldyBBdWRpbygpXG4gICAgICAgICAgICBhdWRpby5zcmMgPSB1cmxcbiAgICAgICAgICAgIHJldHVybiBhdWRpb1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBzZWxmLnJlYWR5Q2FsbGJhY2soc2VsZi5yZWFkeSwgbmFtZSlcbiAgICAgIH0pXG4gIH1cblxuICBfY2FucGxheShldmVudCkge1xuICAgIGV2ZW50LnRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCdjYW5wbGF5JywgdGhpcy5fY2FucGxheSlcbiAgICBjb25zdCB7IG5hbWUsIHRyYWNrIH0gPSBldmVudC50YXJnZXQubG9jYWxJbmZvXG4gICAgdGhpcy5fbG9hZGVkICs9IDFcbiAgICB0aGlzLnJlYWR5ID0gfn4oKHRoaXMuX2xvYWRlZCAvIGNvdW50VG90YWwpICogMTAwKVxuICAgIHRoaXMudHJhY2tzW3RyYWNrXS5yZWFkeSA9IHRydWVcbiAgICAvLyBjb25zb2xlLmxvZyhgJHt0cmFja30uIENhbiBwbGF5ICcke25hbWV9Jy4gUGVuZGluZzogJHt0aGlzLl9wZW5kaW5nfWApXG5cbiAgICBpZiAodGhpcy5fcGVuZGluZyA9PT0gdHJhY2spIHtcbiAgICAgIHRoaXMucGxheSh0aGlzLl9wZW5kaW5nLCAxKVxuICAgICAgdGhpcy5fcGVuZGluZyA9IG51bGxcbiAgICB9XG4gICAgdGhpcy5yZWFkeUNhbGxiYWNrKHRoaXMucmVhZHksIG5hbWUpXG4gIH1cblxuICBfZW5kZWQoKSB7XG4gICAgaWYgKCF0aGlzLl9wbGF5aW5nKSByZXR1cm5cbiAgICBsZXQgbmV4dCA9ICh0aGlzLl9wbGF5aW5nLnRyYWNrID8/IDApICsgMVxuICAgIGlmIChuZXh0ID49IHRoaXMudHJhY2tzLmxlbmd0aCkgbmV4dCA9IDBcbiAgICB0aGlzLl9wbGF5aW5nID0gbnVsbFxuICAgIHRoaXMucGxheShuZXh0LCAxKVxuICB9XG59XG4iXSwibmFtZXMiOlsic291bmRzIiwiZG90IiwidXJsIiwidHlwZSIsImNyb3NzIiwid2hvb3NoIiwic2xpZGUiLCJzdGVwIiwibXVzaWMiLCJuYW1lIiwic3BlZWNoIiwid2luIiwibG9vc2UiLCJjb3VudFRvdGFsIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsInZhbHVlcyIsInJlZHVjZSIsImFjYyIsIml0ZW0iLCJTb3VuZCIsInN0YXRpYyIsInNvdW5kIiwidm9sdW1lIiwibXV0ZWQiLCJ0cmFja3MiLCJfbG9hZGVkIiwicmVhZHkiLCJfcGVuZGluZyIsIl9wbGF5aW5nIiwicmVhZHlDYWxsYmFjayIsInN0YXJ0UGxheUNhbGxiYWNrIiwiZXhjZXB0aW9uQ2FsbGJhY2siLCJjb25zdHJ1Y3RvciIsIl9pbnN0YW5jZSIsInRoaXMiLCJmb3JFYWNoIiwiX2dldFNvdW5kIiwiX2NhbnBsYXkiLCJiaW5kIiwiX2VuZGVkIiwibXVzaWNWb2x1bWUiLCJ2YWx1ZSIsImF1ZGlvIiwibXVzaWNNdXRlZCIsInBsYXkiLCJ0cmFjayIsImxvb3AiLCJjb25zb2xlIiwibG9nIiwidGhlbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJjYXRjaCIsImVycm9yIiwid2FybiIsInVzZSIsImkiLCJjdXJyZW50VGltZSIsImVuZGVkIiwic2F5IiwiTWF0aCIsInJhbmRvbSIsInBhdGgiLCJzZWxmIiwicmVxdWVzdE9iaiIsIlJlcXVlc3QiLCJtZXRob2QiLCJoZWFkZXJzIiwicmVmZXJyZXJQb2xpY3kiLCJmZXRjaCIsInJlc3BvbnNlIiwiYXN5bmMiLCJvdXRjb21lIiwiYmxvYiIsIndpbmRvdyIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsIkF1ZGlvIiwic3JjIiwicHVzaCIsImxvY2FsSW5mbyIsIkFycmF5IiwiZnJvbSIsImV2ZW50IiwidGFyZ2V0IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIm5leHQiXSwic291cmNlUm9vdCI6IiJ9